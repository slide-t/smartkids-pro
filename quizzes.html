<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SmartKids Quiz Hub CBT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===============================
   GLOBAL
================================ */
body { margin:0; font-family:Arial,sans-serif; background:#f4f6f8; }
h2 { position:sticky; top:0; background:#003366; color:#fff; padding:12px; text-align:center; z-index:10; }

.header-bar {
  display:flex; justify-content:space-between; padding:10px;
  background:#e9eef3; font-size:14px;
}

/* ===============================
   QUIZ AREA
================================ */
#quizArea {
  padding:20px;
  max-width:800px;
  margin:auto;
  background:#f4f7fb;
  border-radius:10px;
}

/* QUESTION CARD */
.question-box {
  background:#fff;
  margin-bottom:18px;
  padding:16px;
  border-radius:10px;
  border-left:5px solid #4f46e5;
  box-shadow:0 4px 10px rgba(0,0,0,0.06);
}
.question-box h4 { margin:0 0 10px; font-size:16px; color:#1f2937; }

/* OPTIONS */
.option {
  display:flex; align-items:center; gap:10px;
  padding:10px 12px;
  margin-bottom:8px;
  background:#f9fafb;
  border:1px solid #e5e7eb;
  border-radius:8px;
  cursor:pointer;
  transition: all 0.2s ease;
}
.option:hover { background:#eef2ff; border-color:#6366f1; }
.option input[type="radio"] { transform:scale(1.1); cursor:pointer; }

/* BLINKING FEEDBACK */
.option.correct { background:#c8f7c5; animation: blinkGreen 0.6s ease-in-out 2; }
.option.wrong { background:#f7c5c5; animation: blinkRed 0.6s ease-in-out 2; }

@keyframes blinkGreen { 0% { background:#c8f7c5;} 50% { background:#eaffea;} 100% { background:#c8f7c5;} }
@keyframes blinkRed { 0% { background:#f7c5c5;} 50% { background:#ffeaea;} 100% { background:#f7c5c5;} }

/* BUTTONS */
button {
  padding:10px 18px; border:none; border-radius:8px; font-size:14px; cursor:pointer; margin:5px 0;
}
#submitBtn { background:#4f46e5; color:#fff; width:90%; max-width:400px; display:block; margin:15px auto; }
#submitBtn:disabled { background:#a5b4fc; cursor:not-allowed; }

/* TIMER */
#time { font-weight:bold; color:#dc2626; }

/* ===============================
   BUTTON SYSTEM
================================ */
button {
  appearance: none;
  border: none;
  border-radius: 10px;
  padding: 12px 20px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: transform .15s ease, box-shadow .15s ease, background .2s ease;
  box-shadow: 0 4px 10px rgba(0,0,0,.12);
}

button:active {
  transform: scale(.97);
  box-shadow: 0 2px 6px rgba(0,0,0,.18);
}

/* SUBMIT BUTTON */
#submitBtn {
  display: block;
  width: 100%;
  max-width: 420px;
  margin: 20px auto;
  background: linear-gradient(135deg,#4f46e5,#6366f1);
  color: #fff;
}

#submitBtn:hover {
  background: linear-gradient(135deg,#4338ca,#4f46e5);
}

#submitBtn:disabled {
  background: #c7d2fe;
  cursor: not-allowed;
  box-shadow: none;
}

/* ===============================
   TIMER
================================ */
.timer {
  text-align: center;
  margin: 10px 0;
  font-size: 15px;
}

#time {
  font-weight: 700;
  color: #dc2626;
  font-size: 18px;
}

/* ===============================
   MODALS
================================ */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(15,23,42,.75);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  padding: 10px;
}

.modal-content {
  background: #ffffff;
  width: 100%;
  max-width: 420px;
  padding: 24px 22px;
  border-radius: 14px;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,.25);
  animation: modalPop .25s ease-out;
}

/* MODAL ENTRANCE */
@keyframes modalPop {
  from { transform: scale(.9); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}

/* LEVEL BUTTONS */
.level-btn {
  width: 100%;
  margin: 12px 0;
  padding: 14px;
  font-size: 16px;
  background: linear-gradient(135deg,#22c55e,#16a34a);
  color: #fff;
}

.level-btn:last-child {
  background: linear-gradient(135deg,#2563eb,#1d4ed8);
}

.level-btn:hover {
  filter: brightness(1.05);
}

/* ===============================
   RESULT ACTIONS
================================ */
.result-actions {
  display: grid;
  grid-template-columns: repeat(auto-fit,minmax(140px,1fr));
  gap: 12px;
  margin: 20px auto;
  max-width: 600px;
  padding: 0 15px;
}

.result-actions button {
  background: linear-gradient(135deg,#4f46e5,#6366f1);
  color: #fff;
}

.result-actions button:hover {
  filter: brightness(1.07);
}
   /*====== additional result css ===*/

   /* RESULT MODAL TEXT */
#resultModal .modal-content {
  text-align: left;
  max-width: 420px;
}

#finalScore {
  font-size: 16px;
  line-height: 1.7;
  margin-bottom: 16px;
  color: #1f2937;
  white-space: pre-line;
}

/* STACKED RESULT BUTTONS */
#resultModal .result-actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

#resultModal .result-actions button {
  width: 100%;
  padding: 14px 16px;
  font-size: 15px;
  font-weight: 600;
  border-radius: 10px;
  background: #4f46e5;
  color: #fff;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: 0.2s ease;
}

#resultModal .result-actions button:hover {
  background: #6366f1;
  transform: translateY(-1px);
}

/* NEXT PUPIL HIGHLIGHT */
.next-pupil {
  background: linear-gradient(135deg,#0ea5e9,#0284c7) !important;
}

/* ===============================
   MOBILE TUNING
================================ */
@media (max-width:480px){
  button {
    font-size: 14px;
    padding: 12px 14px;
  }

  .modal-content {
    padding: 20px 16px;
  }
}
/* ===============================
   STUDENT REGISTRATION MODAL
================================ */
#studentModal .modal-content {
  max-width: 420px;
  padding: 26px 22px;
  text-align: left;
}

#studentModal h3 {
  text-align: center;
  margin-bottom: 18px;
  font-size: 18px;
  color: #1f2937;
}

/* INPUTS & SELECT */
#studentModal input,
#studentModal select {
  width: 100%;
  padding: 14px 14px;
  font-size: 15px;
  border-radius: 10px;
  border: 1px solid #d1d5db;
  background: #f9fafb;
  outline: none;
  transition: border .2s, box-shadow .2s, background .2s;
}

#studentModal input::placeholder {
  color: #9ca3af;
}

#studentModal input:focus,
#studentModal select:focus {
  border-color: #4f46e5;
  background: #ffffff;
  box-shadow: 0 0 0 3px rgba(79,70,229,.15);
}

/* SPACING */
#studentModal input,
#studentModal select {
  margin-bottom: 14px;
}

/* CONTINUE BUTTON */
#studentModal button {
  width: 100%;
  padding: 14px;
  font-size: 16px;
  border-radius: 12px;
  background: linear-gradient(135deg,#4f46e5,#6366f1);
  color: #ffffff;
  margin-top: 10px;
}

#studentModal button:hover {
  filter: brightness(1.05);
}
#studentModal input,
#studentModal select {
  box-sizing: border-box;
   }
/* SMALL SCREEN TUNING */
@media (max-width: 480px) {
  #studentModal .modal-content {
    padding: 20px 16px;
  }
}

   /* QUIZ AREA GRID for Responsive layout*/
#quizArea {
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
  padding: 15px;
}

.question-box {
  background: #ffffff;
  border-radius: 10px;
  padding: 14px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.08);
  transition: transform 0.2s, box-shadow 0.2s;
}

.question-box:hover {
  transform: translateY(-3px);
  box-shadow: 0 3px 8px rgba(0,0,0,0.12);
}

@media (min-width: 768px) {
  #quizArea {
    grid-template-columns: 1fr 1fr;
  }
}


</style>
</head>

<body>

<h2>Quiz Hub CBT</h2>

<div class="header-bar">
  <div>Set: <span id="setCount">1</span>/5</div>
  <div><b>Score:</b> <span id="score">0</span></div>
</div>

<div class="timer">Time Left: <span id="time">00:00</span></div>
<div id="quizArea"></div>
<button id="submitBtn">Submit</button>

<!-- STUDENT MODAL -->
<div class="modal" id="studentModal">
  <div class="modal-content">
    <h3>Student Details</h3>
    <input id="studentName" placeholder="Full Name">
    <br><br>
    <input id="schoolName" placeholder="School Name">
    <br><br>
    <select id="studentClass">
      <option value="">Select Class</option>
      <option>Primary 1</option><option>Primary 2</option><option>Primary 3</option>
      <option>Primary 4</option><option>Primary 5</option><option>Primary 6</option>
      <option>JSS 1</option><option>JSS 2</option><option>JSS 3</option>
      <option>SSS 1</option><option>SSS 2</option><option>SSS 3</option>
    </select>
    <br><br>
    <button onclick="saveStudent()">Continue</button>
  </div>
</div>

<!-- LEVEL MODAL -->
<div class="modal" id="levelModal" style="display:none">
  <div class="modal-content">
    <h3>Select Level</h3>
    <button class="level-btn" onclick="startQuiz('primary')">Primary</button>
    <button class="level-btn" onclick="startQuiz('secondary')">Secondary</button>
  </div>
</div>

<!-- RESULT MODAL -->
<div class="modal" id="resultModal" style="display:none">
  <div class="modal-content">
    <p id="finalScore" style="white-space: pre-line;"></p>
    <div class="result-actions">
      <button onclick="window.print()">ðŸ–¨ Print Result</button>
      <button onclick="exportResultPDF()">ðŸ“„ Download PDF</button>
      <button onclick="restartQuiz()">ðŸ”„ Restart Quiz</button>
      <button onclick="nextPupil()">ðŸ‘¤ Next Pupil</button>
    </div>
  </div>
</div>

<script>
/* ===============================
   GLOBAL STATE
================================ */
let student = {};
let selectedLevel = "";
let allQuestions = [];
let currentSet = [];
let totalScore = 0;
let currentSetNumber = 1;

const MAX_SETS = 5;
const QUESTIONS_PER_SET = 5;

/* ===============================
   TIMER
================================ */
let quizTime = 5 * 60; // 5 minutes per set
let timerInterval;
let timerStarted = false;

function startTimer() {
  if (timerStarted) return;
  timerStarted = true;

  timerInterval = setInterval(() => {
    const min = Math.floor(quizTime / 60);
    const sec = quizTime % 60;
    document.getElementById("time").textContent =
      `${min}:${sec.toString().padStart(2, "0")}`;

    if (quizTime <= 0) {
      clearInterval(timerInterval);
      endQuiz();
    }
    quizTime--;
  }, 1000);
}

/* ===============================
   PAGE LOAD
================================ */
window.onload = () => {
  studentModal.style.display = "flex";
};

/* ===============================
   SAVE STUDENT (UPDATED)
================================ */
function saveStudent() {
  const name = document.getElementById("studentName").value.trim();
  const studentClass = document.getElementById("studentClass").value.trim();

  if (!name || !studentClass) {
    alert("Please enter your full name and class");
    return;
  }

  const today = new Date().toISOString().split("T")[0];
  const attemptKey = `attempt_${name}_${studentClass}_${today}`;

  // One attempt per pupil per day
  if (localStorage.getItem(attemptKey)) {
    alert("This pupil has already taken the quiz today.");
    return;
  }

  // Save student
  student = { name, class: studentClass, date: today };

  // Lock attempt
  localStorage.setItem(attemptKey, "done");

  // Reset previous session safely
  sessionStorage.clear();

  studentModal.style.display = "none";
  levelModal.style.display = "flex";
}
   
/* ===============================
   START QUIZ
================================ */
function startQuiz(level) {
  const cls = student.class.toLowerCase();
  const isPrimary = cls.includes("primary") || cls.includes("pri");
  const isSecondary = cls.includes("jss") || cls.includes("sss") || cls.includes("secondary");

  if ((isPrimary && level === "secondary") || (isSecondary && level === "primary")) {
    alert(`${student.class} cannot take ${level} quiz.`);
    return;
  }

  selectedLevel = level;
  sessionStorage.setItem("quizLevel", level);
  levelModal.style.display = "none";

  fetch(level === "primary"
    ? "json-files/quiz-hub/quiz-prim.json"
    : "json-files/quiz-hub/quiz-sec.json"
  )
    .then(res => res.json())
    .then(data => {
      allQuestions = shuffle(
        data.questions.map(q => ({
          question: q.question,
          options: shuffle(
            q.options.map((text, i) => ({ text, isCorrect: i === q.answer }))
          )
        }))
      );

      totalScore = 0;
      currentSetNumber = 1;
      quizTime = 5 * 60; // reset timer per set
      timerStarted = false;

      loadSet();
      startTimer();
    })
    .catch(() => alert("Quiz failed to load"));
}

/* ===============================
   LOAD QUESTIONS
================================ */
function loadSet() {
  document.getElementById("score").textContent = totalScore;
  document.getElementById("setCount").textContent = currentSetNumber;

  const quizArea = document.getElementById("quizArea");
  quizArea.innerHTML = "";

  currentSet = allQuestions.splice(0, QUESTIONS_PER_SET);

  currentSet.forEach((q, i) => {
    quizArea.innerHTML += `
      <div class="question-box">
        <h4>${i + 1}. ${q.question}</h4>
        ${q.options.map((opt, idx) => `
          <label class="option">
            <input type="radio" name="q${i}" value="${idx}">
            ${opt.text}
          </label>
        `).join("")}
      </div>
    `;
  });

  window.scrollTo({ top: 0, behavior: "smooth" });
}

/* ===============================
   SUBMIT ANSWERS
================================ */
submitBtn.onclick = () => {

  // Force all questions answered
  for (let i = 0; i < currentSet.length; i++) {
    if (!document.querySelector(`input[name=q${i}]:checked`)) {
      alert("Please answer all questions before submitting!");
      return;
    }
  }

  submitBtn.disabled = true;

  // Feedback blink
  currentSet.forEach((q, i) => {
    document.querySelectorAll(`input[name=q${i}]`).forEach((input, idx) => {
      const label = input.parentElement;
      label.classList.remove("correct", "wrong");

      if (q.options[idx].isCorrect) label.classList.add("correct");
      if (input.checked && !q.options[idx].isCorrect) label.classList.add("wrong");
    });
  });

  // Calculate score
  currentSet.forEach((q, i) => {
    const chosen = document.querySelector(`input[name=q${i}]:checked`);
    if (chosen && q.options[parseInt(chosen.value)].isCorrect) totalScore++;
  });

  setTimeout(() => {
    submitBtn.disabled = false;
    if (currentSetNumber < MAX_SETS) {
      currentSetNumber++;
      loadSet();
    } else {
      endQuiz();
    }
  }, 1200);
};

/* ===============================
   END QUIZ
================================ */
function endQuiz() {
  clearInterval(timerInterval);
  sessionStorage.setItem("quizCompleted", "true");

  const total = MAX_SETS * QUESTIONS_PER_SET;
  const passMark = Math.ceil(total * 0.5);
  const status = totalScore >= passMark ? "PASS âœ…" : "FAIL âŒ";

  document.getElementById("finalScore").textContent =
    `STUDENT: ${student.name}\nCLASS: ${student.class}\nSCORE: ${totalScore}/${total}\nSTATUS: ${status}\nDATE: ${new Date().toLocaleString()}`;

  resultModal.style.display = "flex";
}

/* ===============================
   RESTART QUIZ
================================ */
function restartQuiz() {
  sessionStorage.removeItem("quizCompleted");
  sessionStorage.removeItem("quizLevel");
  totalScore = 0;
  currentSetNumber = 1;
  allQuestions = [];
  currentSet = [];

  studentModal.style.display = "flex";
  resultModal.style.display = "none";
  levelModal.style.display = "none";
  quizArea.innerHTML = "";
  document.getElementById("time").textContent = "00:00";
}

/* ===============================
   NEXT PUPIL
================================ */
function nextPupil() {
  restartQuiz();
  document.getElementById("studentName").value = "";
  document.getElementById("studentClass").selectedIndex = 0;
}

/* ===============================
   EXPORT PDF
================================ */
function exportResultPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const total = MAX_SETS * QUESTIONS_PER_SET;
  const passMark = Math.ceil(total * 0.5);
  const status = totalScore >= passMark ? "PASS âœ…" : "FAIL âŒ";

  let y = 20;
  doc.setFontSize(16);
  doc.text("QUIZ HUB CBT RESULT", 105, y, { align: "center" });
  y += 15;
  doc.setFontSize(12);
  doc.text(`Student: ${student.name}`, 20, y); y+=8;
  doc.text(`Class: ${student.class}`, 20, y); y+=8;
  doc.text(`Score: ${totalScore} / ${total}`, 20, y); y+=8;
  doc.text(`Status: ${status}`, 20, y); y+=8;
  doc.text(`Date: ${new Date().toLocaleString()}`, 20, y);
  y+=15;
  doc.setFontSize(10);
  doc.text("Generated electronically by Quiz Hub CBT.", 20, y);

  doc.save(`${student.name.replace(/\s+/g,"_")}_CBT_Result.pdf`);
}

/* ===============================
   SHUFFLE QUESTIONS
================================ */
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}
</script>
   
  
  <!-- FOOTER -->
<!-- Font Awesome -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
<!-- Footer Auto Loader -->
<script src="footer-loader.js"></script>

</body>
</html>
</body>
</html>







<!--
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SmartKids Quiz Hub CBT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===============================
   GLOBAL
================================ */
body { margin:0; font-family:Arial,sans-serif; background:#f4f6f8; }
h2 { position:sticky; top:0; background:#003366; color:#fff; padding:12px; text-align:center; z-index:10; }

.header-bar {
  display:flex; justify-content:space-between; padding:10px;
  background:#e9eef3; font-size:14px;
}
   /* QUIZ CONTAINER */
#quizArea {
  padding: 20px;
  max-width: 800px;
  margin: auto;
  background: #f4f7fb;
  border-radius: 10px;
}

/* QUESTION CARD */
.question-box {
  background: #ffffff;
  margin-bottom: 18px;
  padding: 16px;
  border-radius: 10px;
  border-left: 5px solid #4f46e5;
  box-shadow: 0 4px 10px rgba(0,0,0,0.06);
}

/* QUESTION TEXT */
.question-box h4 {
  margin: 0 0 10px;
  font-size: 16px;
  color: #1f2937;
}

/* OPTIONS */
.option {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  margin-bottom: 8px;
  background: #f9fafb;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.option:hover {
  background: #eef2ff;
  border-color: #6366f1;
}

/* RADIO BUTTON */
.option input[type="radio"] {
  transform: scale(1.1);
  cursor: pointer;
}

/* CORRECT / WRONG FEEDBACK */
.option.correct {
  background: #ecfdf5;
  border-color: #10b981;
  animation: blinkGreen 0.4s ease-in-out 3;
}

.option.wrong {
  background: #fef2f2;
  border-color: #ef4444;
  animation: blinkRed 0.4s ease-in-out 3;
}

/* BLINK ANIMATIONS */
@keyframes blinkGreen {
  0%, 100% { background: #ecfdf5; }
  50% { background: #bbf7d0; }
}

@keyframes blinkRed {
  0%, 100% { background: #fef2f2; }
  50% { background: #fecaca; }
}

/* BUTTONS */
button {
  padding: 10px 18px;
  border: none;
  border-radius: 8px;
  font-size: 14px;
  cursor: pointer;
}

#submitBtn {
  background: #4f46e5;
  color: #fff;
}

#submitBtn:disabled {
  background: #a5b4fc;
  cursor: not-allowed;
}

/* TIMER */
#time {
  font-weight: bold;
  color: #dc2626;
}

/* ===============================
   MODALS
================================ */
.modal {
  position:fixed; inset:0; background:rgba(0,0,0,.6);
  display:flex; justify-content:center; align-items:center; z-index:50;
  overflow:auto;
}
.modal-content {
  background:#fff; padding:20px; text-align:center;
  border-radius:8px; width:90%; max-width:400px;
}
.level-btn {
  margin:10px 0;
  animation: shake 1s infinite;
}

/* ===============================
   ANIMATIONS
================================ */
@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-2px); }
  50% { transform: translateX(2px); }
  75% { transform: translateX(-2px); }
  100% { transform: translateX(0); }
}

/* Highlight correct/incorrect answers */
.correct { background:#d4edda; }
.incorrect { background:#f8d7da; }

@media (max-width: 480px) {
  .modal-content { width:95%; padding:15px; }
  button { font-size:14px; padding:10px; }
}

  /* Correct answer blink */
.correct {
  background: #c8f7c5;
  animation: blinkGreen 0.6s ease-in-out 2;
}

/* Wrong answer blink */
.wrong {
  background: #f7c5c5;
  animation: blinkRed 0.6s ease-in-out 2;
}

@keyframes blinkGreen {
  0% { background:#c8f7c5; }
  50% { background:#eaffea; }
  100% { background:#c8f7c5; }
}

@keyframes blinkRed {
  0% { background:#f7c5c5; }
  50% { background:#ffeaea; }
  100% { background:#f7c5c5; }
} 
</style>
</head>

<body>

<h2>Quiz Hub CBT</h2>

<div class="header-bar">
  <div>Set: <span id="setCount">1</span>/5</div>
  <div><b>Score:</b> <span id="score">0</span></div>
</div>

<div class="timer">Time Left: <span id="time">00:00</span></div>
<div id="quizArea"></div>
<button id="submitBtn">Submit</button>

<!-- STUDENT MODAL --
<div class="modal" id="studentModal">
  <div class="modal-content">
    <h3>Student Details</h3>
    <input id="studentName" placeholder="Full Name" style="width:100%; padding:14px; font-size:16px; border-radius:6px; border:1px solid #ccc;">
    <br><br>
    <select id="studentClass" style="width:100%; padding:14px; font-size:16px; border-radius:6px; border:1px solid #ccc;">
      <option value="">Select Class</option>
      <option>Primary 1</option><option>Primary 2</option><option>Primary 3</option>
      <option>Primary 4</option><option>Primary 5</option><option>Primary 6</option>
      <option>JSS 1</option><option>JSS 2</option><option>JSS 3</option>
      <option>SSS 1</option><option>SSS 2</option><option>SSS 3</option>
    </select>
    <br><br>
    <button onclick="saveStudent()">Continue</button>
  </div>
</div>

<!-- LEVEL MODAL --
<div class="modal" id="levelModal" style="display:none">
  <div class="modal-content">
    <h3>Select Level</h3>
    <button class="level-btn" onclick="startQuiz('primary')">Primary</button>
    <button class="level-btn" onclick="startQuiz('secondary')">Secondary</button>
  </div>
</div>

<!-- RESULT MODAL --
<div class="modal" id="resultModal" style="display:none">
  <div class="modal-content">
    <p id="finalScore" style="white-space: pre-line;"></p>
    <button onclick="window.print()">Print Result</button>
    <button onclick="exportResultPDF()">Download Result (PDF)</button>
    <button onclick="restartQuiz()">Restart Quiz</button>
  </div>
</div>
<div class="result-actions">
  <button onclick="window.print()">ðŸ–¨ Print Result</button>
  <button onclick="exportResultPDF()">ðŸ“„ Download PDF</button>
  <button onclick="nextPupil()" class="next-pupil">ðŸ‘¤ Next Pupil</button>
</div>
<!-- JS --

   <script>
/* ===============================
   GLOBAL STATE
================================ */
let student = {};
let selectedLevel = "";
let allQuestions = [];
let currentSet = [];
let totalScore = 0;
let currentSetNumber = 1;

const MAX_SETS = 5;
const QUESTIONS_PER_SET = 5;

/* ===============================
   TIMER
================================ */
let quizTime = 5 * 60; // 5 minutes per set
let timerInterval;
let timerStarted = false;

function startTimer() {
  if (timerStarted) return;
  timerStarted = true;

  timerInterval = setInterval(() => {
    const min = Math.floor(quizTime / 60);
    const sec = quizTime % 60;
    document.getElementById("time").textContent =
      `${min}:${sec.toString().padStart(2, "0")}`;

    if (quizTime <= 0) {
      clearInterval(timerInterval);
      endQuiz();
    }
    quizTime--;
  }, 1000);
}

/* ===============================
   PAGE LOAD
================================ */
window.onload = () => {
  studentModal.style.display = "flex";
};

/* ===============================
   SAVE STUDENT
================================ */
function saveStudent() {
  const name = document.getElementById("studentName").value.trim();
  const studentClass = document.getElementById("studentClass").value.trim();

  if (!name || !studentClass) {
    alert("Please enter your full name and class");
    return;
  }

  student = { name, class: studentClass };

  // Reset previous session
  sessionStorage.removeItem("quizCompleted");
  sessionStorage.removeItem("quizLevel");

  studentModal.style.display = "none";
  levelModal.style.display = "flex";
}

/* ===============================
   START QUIZ (LEVEL LOCK)
================================ */
function startQuiz(level) {
  const cls = student.class.toLowerCase();

  const isPrimaryClass =
    cls.includes("primary") || cls.includes("pri");
  const isSecondaryClass =
    cls.includes("jss") || cls.includes("sss") || cls.includes("secondary");

  if (isPrimaryClass && level === "secondary") {
    alert("Primary pupils cannot take Secondary quiz.");
    return;
  }

  if (isSecondaryClass && level === "primary") {
    alert("Secondary students cannot take Primary quiz.");
    return;
  }

  selectedLevel = level;
  sessionStorage.setItem("quizLevel", level);

  levelModal.style.display = "none";

  fetch(level === "primary"
    ? "json-files/quiz-hub/quiz-prim.json"
    : "json-files/quiz-hub/quiz-sec.json"
  )
    .then(res => res.json())
    .then(data => {
      allQuestions = shuffle(
        data.questions.map(q => ({
          question: q.question,
          options: shuffle(
            q.options.map((text, i) => ({
              text,
              isCorrect: i === q.answer
            }))
          )
        }))
      );

      totalScore = 0;
      currentSetNumber = 1;
      quizTime = 10 * 60;
      timerStarted = false;

      loadSet();
      startTimer();
    })
    .catch(() => alert("Quiz failed to load"));
}

/* ===============================
   LOAD QUESTIONS
================================ */
function loadSet() {
  document.getElementById("score").textContent = totalScore;
  document.getElementById("setCount").textContent = currentSetNumber;

  const quizArea = document.getElementById("quizArea");
  quizArea.innerHTML = "";

  currentSet = allQuestions.splice(0, QUESTIONS_PER_SET);

  currentSet.forEach((q, i) => {
    quizArea.innerHTML += `
      <div class="question-box">
        <h4>${i + 1}. ${q.question}</h4>
        ${q.options.map((opt, idx) => `
          <label class="option">
            <input type="radio" name="q${i}" value="${idx}">
            ${opt.text}
          </label>
        `).join("")}
      </div>
    `;
  });

  window.scrollTo({ top: 0, behavior: "smooth" });
}

/* ===============================
   SUBMIT
================================ */
submitBtn.onclick = () => {

  // 1. Force all answers
  for (let i = 0; i < currentSet.length; i++) {
    if (!document.querySelector(`input[name=q${i}]:checked`)) {
      alert("Please answer all questions before submitting!");
      return;
    }
  }

  // 2. Disable submit during feedback
  submitBtn.disabled = true;

  // 3. Blink feedback
  currentSet.forEach((q, i) => {
    document.querySelectorAll(`input[name=q${i}]`).forEach((input, idx) => {
      const label = input.parentElement;

      if (q.options[idx].isCorrect) {
        label.classList.add("correct");
      }

      if (input.checked && !q.options[idx].isCorrect) {
        label.classList.add("wrong");
      }
    });
  });

  // 4. Calculate score
  currentSet.forEach((q, i) => {
    const chosen = document.querySelector(`input[name=q${i}]:checked`);
    if (chosen && q.options[parseInt(chosen.value)].isCorrect) {
      totalScore++;
    }
  });

  // 5. Move on after delay
  setTimeout(() => {
    submitBtn.disabled = false;

    if (currentSetNumber < MAX_SETS) {
      currentSetNumber++;
      loadSet();   // colors auto-clear
    } else {
      endQuiz();
    }
  }, 1200);
};

/* ===============================
   END QUIZ
================================ */
function endQuiz() {
  clearInterval(timerInterval);

  sessionStorage.setItem("quizCompleted", "true");

  document.getElementById("finalScore").textContent =
    `${student.name} (${student.class})\nScore: ${totalScore}`;

  resultModal.style.display = "flex";
}
/*==========================
   RESTART BUTTON 
=====================â‰ ======*/
      
      function restartQuiz() {
  // Clear quiz-related data
  localStorage.removeItem("sk_session");
  localStorage.removeItem("sk_quiz_score");
  localStorage.removeItem("sk_quiz_answers");

  sessionStorage.removeItem("sk_registered");

  // Redirect back to quizzes page
  window.location.href = "quizzes.html";
}

/* ===============================
   SHUFFLE
================================ */
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}
</script>
   
   <script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/sw.js").then(reg => {
      console.log("âœ… Service Worker registered:", reg.scope);

      // Auto-detect update
      reg.addEventListener("updatefound", () => {
        const newWorker = reg.installing;
        newWorker.addEventListener("statechange", () => {
          if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
            showUpdateBanner(reg);
          }
        });
      });

      // Manual update check button
      createManualCheckButton(reg);
    }).catch(err => console.error("SW registration failed:", err));
  });
}

// âœ… Banner that appears when new version available
function showUpdateBanner(reg) {
  const banner = document.createElement("div");
  banner.innerHTML = `
    <div style="
      position:fixed; bottom:20px; right:20px; z-index:9999;
      background:rgba(255,255,255,0.95); color:#111;
      border:1px solid #ccc; border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
      padding:10px 16px; font-family:sans-serif;
    ">
      <strong>New version available</strong>
      <button id="refreshBtn" style="
        background:#2563eb; color:#fff; border:none;
        padding:6px 10px; border-radius:6px;
        margin-left:8px; cursor:pointer;
      ">Refresh</button>
    </div>
  `;
  document.body.appendChild(banner);

  document.getElementById("refreshBtn").addEventListener("click", () => {
    reg.waiting.postMessage({ type: "SKIP_WAITING" });
    reg.waiting.addEventListener("statechange", e => {
      if (e.target.state === "activated") window.location.reload();
    });
  });
}

// âœ… Small floating button to manually check for updates
function createManualCheckButton(reg) {
  const btn = document.createElement("button");
  btn.textContent = "â†» Check for Updates";
  btn.style = `
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: #2563eb;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    font-size: 13px;
    cursor: pointer;
    z-index: 9999;
  `;
  btn.addEventListener("click", async () => {
    btn.textContent = "ðŸ”„ Checking...";
    try {
      const newReg = await reg.update();
      btn.textContent = "âœ… Up to date";
      setTimeout(() => (btn.textContent = "â†» Check for Updates"), 2500);
    } catch (err) {
      console.error("Error checking updates:", err);
      btn.textContent = "âš ï¸ Error";
      setTimeout(() => (btn.textContent = "â†» Check for Updates"), 2500);
    }
  });
  document.body.appendChild(btn);
}
</script>
  
  <!-- FOOTER -->
<!-- Font Awesome --
<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
<!-- Footer Auto Loader --
<script src="footer-loader.js"></script>

</body>
</html>
