
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quiz Hub CBT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ===============================
   GLOBAL
================================ */
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f4f6f8;
}

h2 {
  position: sticky;
  top: 0;
  background: #003366;
  color: #fff;
  padding: 12px;
  text-align: center;
  z-index: 10;
}

/* ===============================
   HEADER BAR
================================ */
.header-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px;
  background: #e9eef3;
  font-size: 14px;
}

.score-box {
  font-weight: bold;
}

/* ===============================
   TIMER
================================ */
.timer {
  width: 100%;
  background: #003366;
  color: #fff;
  text-align: center;
  padding: 8px;
  font-size: 16px;
}

/* ===============================
   QUIZ AREA
================================ */
#quizArea {
  padding: 15px;
}

.question-box {
  background: #fff;
  margin-bottom: 15px;
  padding: 12px;
  border-radius: 6px;
}

.option {
  display: block;
  padding: 6px 0;
}

/* ===============================
   BUTTON
================================ */
button {
  width: 90%;
  max-width: 400px;
  margin: 15px auto;
  display: block;
  padding: 12px;
  font-size: 16px;
  background: #003366;
  color: #fff;
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

/* ===============================
   MODALS
================================ */
.modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 50;
}

.modal-content {
  background: #fff;
  padding: 20px;
  text-align: center;
  border-radius: 8px;
  width: 90%;
  max-width: 350px;
}

.level-btn {
  margin: 10px 0;
  animation: shake 1s infinite;
}

/* Dancing animation */
@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-2px); }
  50% { transform: translateX(2px); }
  75% { transform: translateX(-2px); }
  100% { transform: translateX(0); }
}
   
   /* ===============================
   CBT OPTION ANIMATION
================================ */

.option {
  display: block;
  padding: 10px 12px;
  margin: 8px 0;
  border: 2px solid #cbd5e1;
  border-radius: 6px;
  cursor: pointer;
  background: #fff;
  transition: background 0.2s, border 0.2s;
}

.option:hover {
  background: #f8fafc;
}

.option input {
  margin-right: 8px;
}

/* Selected option */
.option.selected {
  border-color: #2563eb;
  background: #eff6ff;
}

/* Shake animation */
@keyframes shake {
  0% { transform: translateX(0); }
  25% { transform: translateX(-3px); }
  50% { transform: translateX(3px); }
  75% { transform: translateX(-3px); }
  100% { transform: translateX(0); }
}

.option.shake {
  animation: shake 0.25s ease-in-out;
}
</style>
</head>

<body>

<h2>Quiz Hub CBT</h2>

<div class="header-bar">
  <div>Set: <span id="setCount">1</span>/5</div>
  <div class="score-box">Score: <span id="score">0</span></div>
</div>

<div class="timer">Time Left: <span id="time">00:00</span></div>

<div id="quizArea"></div>

<button id="submitBtn">Submit</button>

<!--Student Capture Modal-->
<div id="studentModal" class="modal">
  <div class="modal-content">
    <h3>Student Information</h3>

    <input id="studentName" placeholder="Full Name">
    <br><br>

    <input id="studentClass" placeholder="Class (e.g. Primary 5)">
    <br><br>

    <button onclick="saveStudent()">Continue</button>
  </div>
</div>
   
   
<!-- LEVEL MODAL -->
<div class="modal" id="levelModal">
  <div class="modal-content">
    <h3>Select Level</h3>
    <button class="level-btn" onclick="startQuiz('primary')">Primary</button>
    <button class="level-btn" onclick="startQuiz('secondary')">Secondary</button>
  </div>
</div>

<!-- FAIL MODAL -->
<div class="modal" id="failModal" style="display:none">
  <div class="modal-content">
    <p id="finalScore"></p>
    <button onclick="restartQuiz()">Ok</button>
  </div>
</div>

<script>
/* ===============================
   SAFE CBT QUIZ ENGINE
================================ */

let allQuestions = [];
let currentSet = [];
let totalScore = 0;
let currentSetNumber = 1;
let quizFile = "";

const MAX_SETS = 5;
const QUESTIONS_PER_SET = 5;

/* ===============================
   TIMER
================================ */
let quizTime = 10 * 60;
let timerInterval;
let timerStarted = false;

function startTimer() {
  if (timerStarted) return;
  timerStarted = true;

  timerInterval = setInterval(() => {
    const min = Math.floor(quizTime / 60);
    const sec = quizTime % 60;
    document.getElementById("time").textContent =
      `${min}:${sec.toString().padStart(2,"0")}`;

    if (quizTime <= 0) {
      clearInterval(timerInterval);
      endQuiz();
    }
    quizTime--;
  }, 1000);
}

/* ===============================
   ANTI-CHEAT
================================ */
let tabSwitches = 0;
document.addEventListener("visibilitychange", () => {
  if (document.hidden) {
    tabSwitches++;
    if (tabSwitches >= 3) {
      endQuiz();
    }
  }
});

/* Prevent back navigation */
history.pushState(null, null, location.href);
window.onpopstate = () => history.pushState(null, null, location.href);

/* Disable backspace */
document.addEventListener("keydown", e => {
  if (e.key === "Backspace" && !e.target.matches("input, textarea")) {
    e.preventDefault();
  }
});

/* ===============================
   START QUIZ
================================ */
function startQuiz(level) {
  quizFile =
    level === "primary"
      ? "json-files/quiz-hub/quiz-prim.json"
      : "json-files/quiz-hub/quiz-sec.json";

  document.getElementById("levelModal").style.display = "none";

  totalScore = 0;
  currentSetNumber = 1;
  quizTime = 10 * 60;
  timerStarted = false;
  tabSwitches = 0;

  fetch(quizFile)
    .then(res => res.json())
    .then(data => {
      allQuestions = shuffle([...data.questions]);
      loadSet();
      startTimer();
    })
    .catch(() => alert("Quiz JSON failed to load"));
}

/* ===============================
   LOAD SET
================================ */
function loadSet() {
  document.getElementById("score").textContent = totalScore;
  document.getElementById("setCount").textContent = currentSetNumber;

  const area = document.getElementById("quizArea");
  area.innerHTML = "";

  currentSet = allQuestions.splice(0, QUESTIONS_PER_SET);

  currentSet.forEach((q, i) => {
    const div = document.createElement("div");
    div.className = "question-box";

    let html = `<h4>${i+1}. ${q.question}</h4>`;
    shuffle(q.options).forEach((opt, idx) => {
      html += `
        <label class="option">
          <input type="radio" name="q${i}" value="${opt}">
          ${opt}
        </label>`;
    });

    div.innerHTML = html;
    area.appendChild(div);
  });
}

/* ===============================
   SUBMIT
================================ */
document.getElementById("submitBtn").onclick = () => {
  let setScore = 0;

  currentSet.forEach((q, i) => {
    const chosen = document.querySelector(`input[name="q${i}"]:checked`);
    if (chosen && chosen.value === q.options[q.answer]) {
      setScore++;
    }
  });

  totalScore += setScore;

  if (currentSetNumber < MAX_SETS) {
    currentSetNumber++;
    loadSet();
  } else {
    endQuiz();
  }
};

/* ===============================
   END QUIZ
================================ */
function endQuiz() {
  clearInterval(timerInterval);

  const TOTAL_QUESTIONS = MAX_SETS * 5; // 25
  const result = getGrade(totalScore, TOTAL_QUESTIONS);

  const message =
    `Score: ${totalScore} / ${TOTAL_QUESTIONS}\n` +
    `Percentage: ${result.percent}%\n` +
    `Grade: ${result.grade}`;

  if (totalScore < 23) {
    document.getElementById("finalScore").innerText =
      message + "\n\nPlease try again.";
    document.getElementById("failModal").style.display = "flex";
  } else {
    alert("Excellent!\n\n" + message);
    restartQuiz();
  }
}
   
   /*function endQuiz() {
  clearInterval(timerInterval);

  if (totalScore < 23) {
    document.getElementById("finalScore").textContent =
      `Your score is ${totalScore}/25. Please try again.`;
    document.getElementById("failModal").style.display = "flex";
  } else {
    alert(`Excellent! You scored ${totalScore}/25`);
    restartQuiz();
  }
}*/
   
/* ===============================
   CBT GRADING SYSTEM (PERCENTAGE)
================================ */

function getGrade(score, totalQuestions) {
  const percent = Math.round((score / totalQuestions) * 100);

  let grade = "F";
  if (percent >= 80) grade = "A";
  else if (percent >= 65) grade = "B";
  else if (percent >= 50) grade = "C";
  else if (percent >= 40) grade = "D";

  return { grade, percent };
}
/* ===============================
   RESTART
================================ */
function restartQuiz() {
  location.reload();
}

/* ===============================
   SHUFFLE
================================ */
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}
let student = {};

function saveStudent() {
  const name = document.getElementById("studentName").value.trim();
  const cls = document.getElementById("studentClass").value.trim();

  if (!name || !cls) {
    alert("Please enter student name and class");
    return;
  }

  student.name = name;
  student.class = cls;

  document.getElementById("studentModal").style.display = "none";
  document.getElementById("levelModal").style.display = "flex";
}
   
</script>
<script>
/* ===============================
   ANTI-CHEAT TAB CONTROL
================================ */

let cheatCount = 0;
const MAX_CHEAT = 2;

/* Detect tab change / minimize */
document.addEventListener("visibilitychange", () => {
  if (document.hidden) {
    handleCheat();
  }
});

/* Detect window blur (desktop & mobile) */
window.addEventListener("blur", () => {
  handleCheat();
});

function handleCheat() {
  cheatCount++;

  if (cheatCount === 1) {
    alert(
      "⚠ WARNING!\n\n" +
      "You are not allowed to leave the quiz screen.\n" +
      "Next attempt will submit your quiz automatically."
    );
  } else if (cheatCount >= MAX_CHEAT) {
    alert(
      "❌ Quiz submitted due to repeated tab switching."
    );
    document.getElementById("submitBtn").click();
  }
}
   
</script>
</body>
</html>
