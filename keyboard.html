<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>SmartKids Pro: Keyboard Tutor</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #0f172a;
    color: #fff;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
  }

  h1 {
    font-size: 1.75rem;
    font-weight: 700;
    margin-bottom: 0.75rem;
    text-align: center;
  }

  .controls {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  select, button {
    background: #1e293b;
    color: #fff;
    border: none;
    border-radius: 0.4rem;
    padding: 0.5rem 0.9rem;
    font-size: 0.9rem;
    cursor: pointer;
    transition: background 0.3s ease;
  }

  button:hover {
    opacity: 0.9;
  }

  #musicToggle { background-color: #db2777; }
  #startBtn { background-color: #2563eb; }
  #pauseBtn { background-color: #facc15; color: #000; }

  /* Stats & Progress */
  .stats {
    width: 100%;
    max-width: 500px;
    text-align: center;
  }

  .stat-line {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    margin-bottom: 0.25rem;
  }

  .progress-bar {
    width: 100%;
    background: #334155;
    height: 0.5rem;
    border-radius: 9999px;
    margin-bottom: 1.5rem;
    overflow: hidden;
  }

  #progressInner {
    background-color: #22c55e;
    height: 100%;
    width: 0%;
    border-radius: 9999px;
    transition: width 0.4s ease;
  }

  /* Word Display */
  #wordDisplay {
    text-align: center;
    font-size: 2rem;
    font-weight: 600;
    letter-spacing: 0.15em;
    margin-bottom: 1.5rem;
    word-wrap: break-word;
  }

  .tile {
    display: inline-block;
    margin: 0 4px;
    padding: 6px 10px;
    font-size: 1.5rem;
    background: #1e293b;
    border-radius: 0.4rem;
    color: #fff;
    opacity: 0;
    transform: translateY(-30px);
    animation: dropIn 0.5s ease forwards;
  }

  @keyframes dropIn {
    0% { opacity: 0; transform: translateY(-40px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  .tile.correct { background-color: #22c55e; }
  .tile.wrong { background-color: #ef4444; }

  /* Input & Feedback */
  #inputBox {
    background: #1e293b;
    border: 2px solid #334155;
    border-radius: 0.5rem;
    padding: 0.75rem;
    font-size: 1.1rem;
    text-align: center;
    color: #fff;
    width: 75%;
    max-width: 280px;
    margin-bottom: 0.75rem;
    outline: none;
  }

  #feedback {
    font-size: 1rem;
    text-align: center;
    margin-bottom: 0.25rem;
  }

  #scoreboard {
    font-size: 0.85rem;
    color: #94a3b8;
    text-align: center;
    margin-bottom: 1rem;
  }

  @media (max-width: 480px) {
    h1 { font-size: 1.4rem; }
    #wordDisplay { font-size: 1.5rem; }
    select, button { font-size: 0.8rem; padding: 0.4rem 0.7rem; }
    .controls { flex-direction: column; align-items: center; }
  }
</style>
<style>
  /* Responsive button area */
  #controls {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 0.6rem;
    margin-bottom: 1rem;
    width: 100%;
    max-width: 220px;
  }

  #controls button,
  #controls select {
    width: 100%;
    font-size: 1rem;
  }

  @media (max-width: 640px) {
    #controls {
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 100%;
    }

    #controls button,
    #controls select {
      width: auto;
      flex: 1;
      min-width: 120px;
    }
  }
</style>
  
</head>

<body>
  <h1>SmartKids Pro: Keyboard Tutor</h1>

  <div class="controls" id="controls">
    <select id="yearSelect">
      <option value="">Select Year</option>
    </select>
    <button id="startBtn">Start</button>
   <button id="pauseBtn">‚è∏ Pause</button
    <button id="musicToggle">üîä Music On</button>
  </div>

  <!-- Stats -->
  <div class="stats">
    <div class="stat-line">
      <span>Timer: <span id="timer">0</span>s</span>
      <span>WPM: <span id="wpm">0</span></span>
      <span>Progress: <span id="progressCount">0%</span></span>
    </div>
    <div class="progress-bar">
      <div id="progressInner"></div>
    </div>
  </div>

  <!-- Word Display -->
  <div id="wordDisplay"></div>

  <!-- Input & Feedback -->
  <input id="inputBox" type="text" placeholder="Type here..." class="hidden" />
  <div id="feedback"></div>
  <div id="scoreboard"></div>



<script>
document.addEventListener("DOMContentLoaded", () => {
  const startBtn = document.getElementById("startBtn");
  const yearSelect = document.getElementById("yearSelect");
  const inputBox = document.getElementById("inputBox");
  const wordDisplay = document.getElementById("wordDisplay");
  const timerEl = document.getElementById("timer");
  const wpmEl = document.getElementById("wpm");
  const feedback = document.getElementById("feedback");
  const progressInner = document.getElementById("progressInner");
  const progressCount = document.getElementById("progressCount");
  const scoreboard = document.getElementById("scoreboard");
  const musicToggle = document.getElementById("musicToggle");

  let lessonsData = {};
  let words = [];
  let currentIndex = 0;
  let correctCount = 0;
  let timer = 0;
  let totalTyped = 0;
  let interval;
  let startTime;
  let isPaused = false;
  let bgMusic = new Audio("sounds/bg-music.mp3");
  bgMusic.loop = true;

  // üéß Toggle music
  musicToggle.addEventListener("click", () => {
    if (bgMusic.paused) {
      bgMusic.play();
      musicToggle.textContent = "üîä Music On";
    } else {
      bgMusic.pause();
      musicToggle.textContent = "üîá Music Off";
    }
  });

  // üéØ Fetch JSON data
  fetch("json-files/keyboard_lessons.json")
    .then(res => res.json())
    .then(data => {
      lessonsData = data;
      Object.keys(data).forEach(year => {
        const opt = document.createElement("option");
        opt.value = year;
        opt.textContent = year;
        yearSelect.appendChild(opt);
      });
    })
    .catch(err => console.error("Error loading JSON:", err));

  // üïì Create Timer Selector dynamically
  const timeSelect = document.createElement("select");
  timeSelect.id = "timeSelect";
  timeSelect.className = "bg-slate-800 text-white rounded p-2";
  timeSelect.innerHTML = `
    <option value="15">15s</option>
    <option value="20">20s</option>
    <option value="25">25s</option>
  `;
  startBtn.parentNode.insertBefore(timeSelect, startBtn.nextSibling);

  // üéÆ Adjust available time options based on Year
  yearSelect.addEventListener("change", () => {
    const selectedYear = yearSelect.value;
    timeSelect.innerHTML = "";
    if (selectedYear.startsWith("Year 7") || selectedYear.startsWith("Year 8") ||
        selectedYear.startsWith("Year 9") || selectedYear.startsWith("Year 10") ||
        selectedYear.startsWith("Year 11") || selectedYear.startsWith("Year 12")) {
      [30, 60].forEach(sec => {
        const opt = document.createElement("option");
        opt.value = sec;
        opt.textContent = `${sec}s`;
        timeSelect.appendChild(opt);
      });
    } else {
      [15, 20, 25].forEach(sec => {
        const opt = document.createElement("option");
        opt.value = sec;
        opt.textContent = `${sec}s`;
        timeSelect.appendChild(opt);
      });
    }
  });

  // üïπ Start Game
  startBtn.addEventListener("click", () => {
    const selectedYear = yearSelect.value;
    if (!selectedYear) return alert("Please select a Year level!");

    words = lessonsData[selectedYear].items;
    currentIndex = 0;
    correctCount = 0;
    totalTyped = 0;
    feedback.textContent = "";
    wordDisplay.innerHTML = "";
    inputBox.value = "";
    inputBox.classList.remove("hidden");
    inputBox.focus();
    progressInner.style.width = "0%";
    progressCount.textContent = "0%";
    timerEl.textContent = "0";
    wpmEl.textContent = "0";

    timer = parseInt(timeSelect.value) || 15;
    startTime = Date.now();
    clearInterval(interval);
    updateWord();
    startTimer();
  });

  // üß† Timer & Progress
  function startTimer() {
    interval = setInterval(() => {
      if (!isPaused) {
        timer--;
        timerEl.textContent = timer;
        const percent = (currentIndex / words.length) * 100;
        progressInner.style.width = percent + "%";
        progressCount.textContent = Math.round(percent) + "%";

        // Update WPM
        const timeElapsed = (Date.now() - startTime) / 1000 / 60;
        const wpm = totalTyped > 0 && timeElapsed > 0 ? Math.round(totalTyped / timeElapsed / 5) : 0;
        wpmEl.textContent = wpm;

        if (timer <= 0) {
          nextWord();
        }
      }
    }, 1000);
  }

  // üß© Display Words
  function updateWord() {
    if (currentIndex >= words.length) {
      endLevel();
      return;
    }

    const word = words[currentIndex];
    wordDisplay.innerHTML = "";
    [...word].forEach((letter, i) => {
      const span = document.createElement("span");
      span.textContent = letter;
      span.className = "tile";
      span.style.animationDelay = `${i * 0.05}s`;
      wordDisplay.appendChild(span);
    });
  }

  // ‚úÖ Input Logic
  inputBox.addEventListener("input", () => {
    const currentWord = words[currentIndex];
    const userInput = inputBox.value.trim();
    totalTyped++;

    if (userInput === currentWord) {
      correctCount++;
      inputBox.value = "";
      feedback.textContent = "‚úÖ Correct!";
      feedback.className = "text-green-400";
      nextWord();
    } else if (!currentWord.startsWith(userInput)) {
      feedback.textContent = "‚ùå Wrong!";
      feedback.className = "text-red-400";
    } else {
      feedback.textContent = "";
    }

    scoreboard.textContent = `Score: ${correctCount}/${words.length}`;
  });

  // ‚ñ∂Ô∏è Next Word
  function nextWord() {
    currentIndex++;
    if (currentIndex < words.length) {
      timer = parseInt(timeSelect.value);
      updateWord();
    } else {
      endLevel();
    }
  }

  // üèÅ End of Level
  function endLevel() {
    clearInterval(interval);
    wordDisplay.innerHTML = `<span class="text-green-400 text-2xl">üéâ Congratulations! You‚Äôve completed this level.</span>`;
    inputBox.classList.add("hidden");
    progressInner.style.width = "100%";
    progressCount.textContent = "100%";
  }

  // ‚è∏ Pause / Resume Button
  const pauseBtn = document.createElement("button");
  pauseBtn.textContent = "‚è∏ Pause";
  pauseBtn.className = "bg-yellow-600 hover:bg-yellow-500 px-4 py-2 rounded mt-3 w-full";
  document.getElementById("startBtn").parentNode.appendChild(pauseBtn);

  pauseBtn.addEventListener("click", () => {
    isPaused = !isPaused;
    pauseBtn.textContent = isPaused ? "‚ñ∂ Resume" : "‚è∏ Pause";
  });
});
</script>

</body>
</html>
