<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keyboard Tutor | SmartKids-Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .key {
      @apply border rounded-lg p-2 w-8 h-8 flex items-center justify-center text-gray-700 bg-gray-100 shadow-sm transition;
    }
    .key.active {
      @apply bg-blue-500 text-white scale-110;
    }
    .key.correct {
      @apply bg-green-500 text-white;
    }
    .key.wrong {
      @apply bg-red-500 text-white;
    }
    .highlighted {
      background-color: #dbeafe; /* blue-100 */
      border-radius: 4px;
      padding: 0 2px;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex flex-col items-center py-10">

  <h1 class="text-3xl font-bold text-blue-800 mb-6">Keyboard Tutor</h1>

  <div id="activityContainer" class="w-full max-w-3xl bg-white rounded-2xl shadow-md p-6 space-y-6 text-center">
    <p class="text-gray-600">Loading activities...</p>
  </div>

  <!-- Virtual Keyboard -->
  <div id="virtualKeyboard" class="mt-10 grid gap-1 text-sm font-semibold"></div>

  <script>
    const container = document.getElementById("activityContainer");
    const keyboardContainer = document.getElementById("virtualKeyboard");

    let activities = [];
    let currentIndex = 0;
    let currentExpected = "";
    let currentPos = 0;

    fetch("json-files/keyboard.json")
      .then(res => res.json())
      .then(data => {
        activities = data.activities;
        loadActivity();
        buildKeyboard();
      })
      .catch(() => container.innerHTML = `<p class='text-red-500'>Error loading data</p>`);

    // Load typing activity
    function loadActivity() {
      if (currentIndex >= activities.length) {
        container.innerHTML = `
          <h2 class='text-2xl font-semibold text-green-600'>ðŸŽ‰ Completed!</h2>
          <p class='text-gray-700'>Youâ€™ve mastered all keyboard practices!</p>`;
        return;
      }

      currentExpected = activities[currentIndex].expected;
      currentPos = 0;

      container.innerHTML = `
        <h2 class="text-xl font-semibold text-blue-700 mb-2">Practice ${currentIndex + 1}</h2>
        <p class="text-gray-800 mb-3">${activities[currentIndex].instruction}</p>
        <div id="practiceText" class="font-mono text-lg bg-gray-100 p-4 rounded">${highlightText()}</div>
        <textarea id="inputText" class="w-full border rounded-lg p-2 mt-3 focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Start typing..."></textarea>
        <p id="feedback" class="text-sm mt-2 font-semibold"></p>
      `;

      const input = document.getElementById("inputText");
      input.focus();

      input.addEventListener("keydown", handleKeyPress);
    }

    // Highlight typed letters
    function highlightText() {
      let output = "";
      for (let i = 0; i < currentExpected.length; i++) {
        if (i === currentPos) {
          output += `<span class='highlighted'>${currentExpected[i]}</span>`;
        } else {
          output += currentExpected[i];
        }
      }
      return output;
    }

    // Handle typing
    function handleKeyPress(e) {
      const key = e.key;

      highlightVirtualKey(key);

      if (key.length > 1 && key !== "Backspace" && key !== "Enter") return; // ignore non-character keys

      if (key === "Backspace" && currentPos > 0) {
        currentPos--;
      } else if (key === currentExpected[currentPos]) {
        currentPos++;
      } else if (key !== currentExpected[currentPos] && key.length === 1) {
        wrongKeyFlash(key);
      }

      // Update text display
      document.getElementById("practiceText").innerHTML = highlightText();

      // Check if done
      if (currentPos >= currentExpected.length) {
        document.getElementById("feedback").innerHTML = `<span class='text-green-600'>âœ… Great job! Loading next...</span>`;
        setTimeout(() => {
          currentIndex++;
          loadActivity();
        }, 1500);
      }
    }

    // Build visual keyboard
    function buildKeyboard() {
      const layout = [
        "1234567890",
        "qwertyuiop",
        "asdfghjkl",
        "zxcvbnm"
      ];

      keyboardContainer.innerHTML = "";
      layout.forEach(row => {
        const div = document.createElement("div");
        div.className = "flex justify-center space-x-1";
        for (let ch of row) {
          const key = document.createElement("div");
          key.className = "key";
          key.id = `key-${ch}`;
          key.textContent = ch;
          div.appendChild(key);
        }
        keyboardContainer.appendChild(div);
      });
    }

    // Highlight key pressed
    function highlightVirtualKey(key) {
      const lowerKey = key.toLowerCase();
      const keyDiv = document.getElementById(`key-${lowerKey}`);
      if (!keyDiv) return;

      keyDiv.classList.add("active");
      setTimeout(() => keyDiv.classList.remove("active"), 150);
    }

    // Wrong key animation
    function wrongKeyFlash(key) {
      const lowerKey = key.toLowerCase();
      const keyDiv = document.getElementById(`key-${lowerKey}`);
      if (keyDiv) {
        keyDiv.classList.add("wrong");
        setTimeout(() => keyDiv.classList.remove("wrong"), 300);
      }
    }
  </script>
</body>
</html>
