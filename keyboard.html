<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<script>
(function () {
  const isAdmin = sessionStorage.getItem("sk_admin") === "yes";
  const session = JSON.parse(localStorage.getItem("sk_session"));

  // Admin can navigate freely
  if (isAdmin) return;

  // Pupils must have a valid session
  if (!session || Date.now() > session.expiresAt) {
    localStorage.removeItem("sk_session");
    sessionStorage.removeItem("sk_registered");
    location.replace("index.html");
  }
})();
</script>
  <title>SmartKids Pro: Keyboard Tutor</title>
<link rel="stylesheet" href="style.css"/>
<script>

  <style>
  body {
    font-family: 'Poppins', sans-serif;
    background: #0f172a;
    color: #fff;
    margin: 0;
    height: 100vh;
    overflow: hidden;
    display: flex;
  }

  /* üéà Bubble background animation */
  .bubbles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: 0;
  }

  .bubble {
    position: absolute;
    bottom: -100px;
    width: 20px;
    height: 20px;
    background: rgba(255,255,255,0.1);
    border-radius: 50%;
    animation: rise 15s infinite ease-in;
  }

  @keyframes rise {
    0% { transform: translateY(0) scale(1); opacity: 0.5; }
    100% { transform: translateY(-1200px) scale(1.2); opacity: 0; }
  }

  /* üéØ Layout */
  .main-container {
    display: grid;
    grid-template-columns: 1fr 250px;
    width: 100%;
    height: 100%;
    position: relative;
    z-index: 1;
  }

  .left-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    position: relative;
  }

  .right-sidebar {
    background: #1e293b;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.7rem;
    align-items: stretch;
    justify-content: flex-start;
    border-left: 3px solid #334155;
  }

  select, button {
    background: #334155;
    color: #fff;
    border: none;
    border-radius: 0.4rem;
    padding: 0.7rem;
    font-size: 1rem;
    cursor: pointer;
    transition: 0.3s ease;
    width: 100%;
  }

  button:hover { opacity: 0.9; }

  #musicToggle { background-color: #db2777; }
  #startBtn { background-color: #2563eb; }
  #pauseBtn { background-color: #facc15; color: #000; }

  /* üß† Stats */
  .stats {
    text-align: center;
    width: 100%;
    max-width: 500px;
    margin-top: 1rem;
  }

  .stat-line {
    display: flex;
    justify-content: space-between;
    font-size: 0.85rem;
    margin-bottom: 0.3rem;
  }

  .progress-bar {
    width: 100%;
    height: 0.6rem;
    border-radius: 9999px;
    background: #334155;
    overflow: hidden;
    margin-bottom: 1.5rem;
  }

  #progressInner {
    height: 100%;
    width: 0%;
    background-color: #22c55e;
    border-radius: 9999px;
    transition: width 0.4s ease;
  }

  /* üß© Word Display */
  #wordDisplay {
    text-align: center;
    font-size: 2.4rem;
    font-weight: 600;
    letter-spacing: 0.15em;
    margin-bottom: 1.5rem;
    word-wrap: break-word;
    width: 80%;
  }

  .tile {
    display: inline-block;
    margin: 0 4px;
    padding: 6px 10px;
    font-size: 1.8rem;
    background: #1e293b;
    border-radius: 0.4rem;
    color: #fff;
    opacity: 0;
    transform: translateY(-30px);
    animation: dropIn 0.5s ease forwards;
  }

  @keyframes dropIn {
    0% { opacity: 0; transform: translateY(-40px); }
    100% { opacity: 1; transform: translateY(0); }
  }

  .tile.correct { background-color: #22c55e; }
  .tile.wrong { background-color: #ef4444; }

  #inputBox {
    background: #1e293b;
    border: 2px solid #334155;
    border-radius: 0.5rem;
    padding: 0.75rem;
    font-size: 1.1rem;
    text-align: center;
    color: #fff;
    width: 75%;
    max-width: 300px;
    margin-bottom: 0.5rem;
    outline: none;
  }

  #feedback {
    font-size: 1rem;
    text-align: center;
    margin-bottom: 0.25rem;
  }

  #scoreboard {
    font-size: 0.85rem;
    color: #94a3b8;
    text-align: center;
  }

  @media (max-width: 768px) {
    .main-container {
      grid-template-columns: 1fr;
      grid-template-rows: auto auto;
    }
    .right-sidebar {
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      border-left: none;
      border-top: 3px solid #334155;
    }
    .left-panel { padding: 1rem; }
  }

 /* Header Styles */
  .header-bar {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(90deg, #0078ff, #00c4ff);
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 18px;
    font-family: 'Poppins', sans-serif;
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(0,0,0,0.25);
  }

  .header-title {
    font-size: 20px;
    margin: 0;
    font-weight: 600;
  }

  .home-btn {
    background: white;
    color: #0078ff;
    padding: 8px 16px;
    border-radius: 8px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    margin-right: 4px;
  }

  .home-btn:hover {
    background: #0078ff;
    color: white;
    box-shadow: 0 0 6px rgba(255,255,255,0.6);
  }

  /* Body padding to prevent overlap */
  body {
    padding-top: 60px;
  }

  /* Mobile responsive */
  @media (max-width: 600px) {
    .header-bar {
      flex-direction: column;
      text-align: center;
      gap: 6px;
    }
    .home-btn {
      width: 100%;
      max-width: 120px;
      margin: 0 auto;
    }
  }
</style>
  
</head>

<body>

  <div id="sk_pupil_info" class="fixed top-0 left-0 w-full bg-[#1446b8] text-white py-2 px-4 text-sm font-medium flex justify-between items-center hidden">
  <span id="sk_pupil_name"></span>
  <span id="sk_school_name"></span>
  <span id="sk_school_code"></span>
</div>

<!-- üåü HEADER SECTION -->
<header class="header-bar">
  <h1 class="header-title">Keyboard Lessons</h1>
  <a href="index.html" class="home-btn">üè† Home</a>
</header>

 <!-- Background bubbles -->
  <div class="bubbles">
    <div class="bubble" style="left:10%; animation-duration:14s; width:15px; height:15px;"></div>
    <div class="bubble" style="left:30%; animation-duration:18s; width:20px; height:20px;"></div>
    <div class="bubble" style="left:50%; animation-duration:20s; width:10px; height:10px;"></div>
    <div class="bubble" style="left:70%; animation-duration:16s; width:25px; height:25px;"></div>
    <div class="bubble" style="left:85%; animation-duration:22s; width:18px; height:18px;"></div>
  </div>

  <div class="main-container">
    <!-- Left: Game Area -->
    <div class="left-panel">
      <h1>SmartKids Pro: Keyboard Tutor</h1>

      <div class="stats">
        <div class="stat-line">
          <span>Timer: <span id="timer">0</span>s</span>
          <span>WPM: <span id="wpm">0</span></span>
          <span>Progress: <span id="progressCount">0%</span></span>
        </div>
        <div class="progress-bar"><div id="progressInner"></div></div>
      </div>

      <div id="wordDisplay"></div>
      <input id="inputBox" type="text" placeholder="Type here..." class="hidden" />
      <div id="feedback"></div>
      <div id="scoreboard"></div>
    </div>

    <!-- Right: Sidebar -->
    <div class="right-sidebar">
      <select id="yearSelect">
        <option value="">Select Year</option>
      </select>
      <select id="timeSelect">
        <option value="15">15s</option>
        <option value="20">20s</option>
        <option value="25">25s</option>
      </select>
      <button id="startBtn">Start</button>
      <button id="pauseBtn">‚è∏ Pause</button>
      <button id="musicToggle">üîä Music On</button>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const startBtn = document.getElementById("startBtn");
  const yearSelect = document.getElementById("yearSelect");
  const timeSelect = document.getElementById("timeSelect");
  const inputBox = document.getElementById("inputBox");
  const wordDisplay = document.getElementById("wordDisplay");
  const timerEl = document.getElementById("timer");
  const wpmEl = document.getElementById("wpm");
  const feedback = document.getElementById("feedback");
  const progressInner = document.getElementById("progressInner");
  const progressCount = document.getElementById("progressCount");
  const scoreboard = document.getElementById("scoreboard");
  const musicToggle = document.getElementById("musicToggle");
  const pauseBtn = document.getElementById("pauseBtn");

  let lessonsData = {};
  let words = [];
  let currentIndex = 0;
  let correctCount = 0;
  let timer = 0;
  let totalTyped = 0;
  let interval;
  let startTime;
  let isPaused = false;

  const bgMusic = new Audio("sounds/bg-music.mp3");
  bgMusic.loop = true;

  // üéß Music
  musicToggle.addEventListener("click", () => {
    if (bgMusic.paused) {
      bgMusic.play();
      musicToggle.textContent = "üîä Music On";
    } else {
      bgMusic.pause();
      musicToggle.textContent = "üîá Music Off";
    }
  });

  // üéØ Load Lessons
  fetch("json-files/keyboard_lessons.json")
    .then(res => res.json())
    .then(data => {
      lessonsData = data;
      Object.keys(data).forEach(year => {
        const opt = document.createElement("option");
        opt.value = year;
        opt.textContent = year;
        yearSelect.appendChild(opt);
      });
    })
    .catch(err => console.error("Error loading JSON:", err));

  // üïì Adjust Timer Choices
  yearSelect.addEventListener("change", () => {
    const selectedYear = yearSelect.value;
    timeSelect.innerHTML = "";
    if (/Year (7|8|9|10|11|12)/.test(selectedYear)) {
      [30, 60].forEach(sec => {
        const opt = document.createElement("option");
        opt.value = sec;
        opt.textContent = `${sec}s`;
        timeSelect.appendChild(opt);
      });
    } else {
      [15, 20, 25].forEach(sec => {
        const opt = document.createElement("option");
        opt.value = sec;
        opt.textContent = `${sec}s`;
        timeSelect.appendChild(opt);
      });
    }
  });

  // üèÅ Start
  startBtn.addEventListener("click", () => {
    const selectedYear = yearSelect.value;
    if (!selectedYear) return alert("Please select a Year level!");

    words = lessonsData[selectedYear].items;
    currentIndex = 0;
    correctCount = 0;
    totalTyped = 0;
    feedback.textContent = "";
    wordDisplay.innerHTML = "";
    inputBox.value = "";
    inputBox.classList.remove("hidden");
    inputBox.focus();
    progressInner.style.width = "0%";
    progressCount.textContent = "0%";
    timerEl.textContent = "0";
    wpmEl.textContent = "0";

    timer = parseInt(timeSelect.value);
    startTime = Date.now();
    clearInterval(interval);
    updateWord();
    startTimer();
  });

  // Timer
  function startTimer() {
    interval = setInterval(() => {
      if (!isPaused) {
        timer--;
        timerEl.textContent = timer;
        const percent = (currentIndex / words.length) * 100;
        progressInner.style.width = percent + "%";
        progressCount.textContent = Math.round(percent) + "%";

        const timeElapsed = (Date.now() - startTime) / 1000 / 60;
        const wpm = totalTyped > 0 && timeElapsed > 0 ? Math.round((totalTyped / 5) / timeElapsed) : 0;
        wpmEl.textContent = wpm;

        if (timer <= 0) nextWord();
      }
    }, 1000);
  }

  // Display
  function updateWord() {
    if (currentIndex >= words.length) {
      endLevel();
      return;
    }
    const word = words[currentIndex];
    wordDisplay.innerHTML = "";
    [...word].forEach((letter, i) => {
      const span = document.createElement("span");
      span.textContent = letter;
      span.className = "tile";
      span.style.animationDelay = `${i * 0.05}s`;
      wordDisplay.appendChild(span);
    });
  }

  // Input
  inputBox.addEventListener("input", () => {
    const currentWord = words[currentIndex];
    const userInput = inputBox.value.trim();
    totalTyped++;

    if (userInput === currentWord) {
      correctCount++;
      inputBox.value = "";
      feedback.textContent = "‚úÖ Correct!";
      feedback.className = "text-green-400";
      nextWord();
    } else if (!currentWord.startsWith(userInput)) {
      feedback.textContent = "‚ùå Wrong!";
      feedback.className = "text-red-400";
    } else feedback.textContent = "";

    scoreboard.textContent = `Score: ${correctCount}/${words.length}`;
  });

  function nextWord() {
    currentIndex++;
    if (currentIndex < words.length) {
      timer = parseInt(timeSelect.value);
      updateWord();
    } else endLevel();
  }

  function endLevel() {
    clearInterval(interval);
    wordDisplay.innerHTML = `<span class="text-green-400 text-2xl">üéâ Congratulations! You‚Äôve completed this level.</span>`;
    inputBox.classList.add("hidden");
    progressInner.style.width = "100%";
    progressCount.textContent = "100%";
  }

  // Pause
  pauseBtn.addEventListener("click", () => {
    isPaused = !isPaused;
    pauseBtn.textContent = isPaused ? "‚ñ∂ Resume" : "‚è∏ Pause";
  });
});
</script>

  <script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("/sw.js").then(reg => {
      console.log("‚úÖ Service Worker registered:", reg.scope);

      // Auto-detect update
      reg.addEventListener("updatefound", () => {
        const newWorker = reg.installing;
        newWorker.addEventListener("statechange", () => {
          if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
            showUpdateBanner(reg);
          }
        });
      });

      // Manual update check button
      createManualCheckButton(reg);
    }).catch(err => console.error("SW registration failed:", err));
  });
}

// ‚úÖ Banner that appears when new version available
function showUpdateBanner(reg) {
  const banner = document.createElement("div");
  banner.innerHTML = `
    <div style="
      position:fixed; bottom:20px; right:20px; z-index:9999;
      background:rgba(255,255,255,0.95); color:#111;
      border:1px solid #ccc; border-radius:8px;
      box-shadow:0 2px 8px rgba(0,0,0,0.15);
      padding:10px 16px; font-family:sans-serif;
    ">
      <strong>New version available</strong>
      <button id="refreshBtn" style="
        background:#2563eb; color:#fff; border:none;
        padding:6px 10px; border-radius:6px;
        margin-left:8px; cursor:pointer;
      ">Refresh</button>
    </div>
  `;
  document.body.appendChild(banner);

  document.getElementById("refreshBtn").addEventListener("click", () => {
    reg.waiting.postMessage({ type: "SKIP_WAITING" });
    reg.waiting.addEventListener("statechange", e => {
      if (e.target.state === "activated") window.location.reload();
    });
  });
}

// ‚úÖ Small floating button to manually check for updates
function createManualCheckButton(reg) {
  const btn = document.createElement("button");
  btn.textContent = "‚Üª Check for Updates";
  btn.style = `
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: #2563eb;
    color: #fff;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    font-size: 13px;
    cursor: pointer;
    z-index: 9999;
  `;
  btn.addEventListener("click", async () => {
    btn.textContent = "üîÑ Checking...";
    try {
      const newReg = await reg.update();
      btn.textContent = "‚úÖ Up to date";
      setTimeout(() => (btn.textContent = "‚Üª Check for Updates"), 2500);
    } catch (err) {
      console.error("Error checking updates:", err);
      btn.textContent = "‚ö†Ô∏è Error";
      setTimeout(() => (btn.textContent = "‚Üª Check for Updates"), 2500);
    }
  });
  document.body.appendChild(btn);
}
</script>

<!-- HARD BLOCK OVERLAY -->
<div id="basicGateOverlay">
  <div id="basicGateModal">
    <h2>‚å®Ô∏è Start Here First</h2>
    <p>
      You must complete the <b>Basic Keyboard Practice</b> before continuing.
    </p>
    <button onclick="goToBasics()">Go to Basic Practice ‚Üí</button>
  </div>
</div>

<style>
  /* Overlay */
  #basicGateOverlay {
    position: fixed;
    inset: 0;
    z-index: 2147483647;
    background: rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);

    /* PERFECT CENTERING */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* Modal */
  #basicGateModal {
    background: #ffffff;
    border-radius: 16px;
    padding: 24px;
    width: 90%;
    max-width: 380px;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.25);
  }

  #basicGateModal h2 {
    font-size: 1.25rem;
    font-weight: 700;
    margin-bottom: 8px;
  }

  #basicGateModal p {
    color: #555;
    margin-bottom: 16px;
  }

  #basicGateModal button {
    background: #2563eb;
    color: white;
    padding: 10px 18px;
    border-radius: 8px;
    font-weight: 600;
    border: none;
    cursor: pointer;
  }

  #basicGateModal button:hover {
    background: #1e40af;
  }
</style>

<script>
  // Lock background completely
  document.documentElement.style.overflow = 'hidden';
  document.body.style.overflow = 'hidden';

  function goToBasics() {
    window.location.href = 'keyboardbasics.html';
  }
</script>
<script>
(function() {
  const session = JSON.parse(localStorage.getItem("sk_session"));

  // If no session or expired ‚Üí hide info bar
  if (!session || Date.now() > session.expiresAt) {
    document.getElementById('sk_pupil_info')?.classList.add('hidden');
    return;
  }

  // Populate info bar
  document.getElementById('sk_pupil_name').textContent = "Pupil: " + session.pupil;
  document.getElementById('sk_school_name').textContent = "School: " + session.school;
  document.getElementById('sk_school_code').textContent = "Code: " + session.schoolCode;

  // Show info bar
  document.getElementById('sk_pupil_info')?.classList.remove('hidden');
})();
</script>
</body>
</html>



