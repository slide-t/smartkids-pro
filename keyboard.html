<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Keyboard Tutor | SmartKids-Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen flex flex-col items-center py-10">

  <h1 class="text-3xl font-bold text-blue-800 mb-6">Keyboard Tutor</h1>

  <div id="activityContainer" class="w-full max-w-3xl bg-white rounded-2xl shadow-md p-6 space-y-6 text-center">
    <p class="text-gray-600 text-center">Loading activities...</p>
  </div>

  <script>
    let activities = [];
    let currentIndex = 0;
    const minAccuracy = 95; // strict condition

    const container = document.getElementById("activityContainer");

    // Load JSON
    fetch("json-files/keyboard.json")
      .then(res => res.json())
      .then(data => {
        activities = data.activities;
        currentIndex = parseInt(localStorage.getItem("currentPractice")) || 0;
        loadActivity();
      })
      .catch(() => {
        container.innerHTML = `<p class="text-red-500">Failed to load activities.</p>`;
      });

    // Load one activity
    function loadActivity() {
      if (currentIndex >= activities.length) {
        container.innerHTML = `
          <h2 class="text-2xl font-semibold text-green-600">üéâ Congratulations!</h2>
          <p class="text-gray-700">You‚Äôve completed all keyboard practices!</p>`;
        localStorage.removeItem("currentPractice");
        return;
      }

      const act = activities[currentIndex];
      container.innerHTML = `
        <h2 class="text-xl font-semibold text-blue-700 mb-2">Practice ${currentIndex + 1}</h2>
        <p class="text-gray-800 mb-3">${act.instruction}</p>
        <div class="mb-4 p-3 bg-gray-100 rounded text-left text-sm text-gray-700 font-mono">
          ${act.expected}
        </div>
        <textarea id="inputText" class="w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500" rows="4" placeholder="Type here..."></textarea>
        <button onclick="checkAccuracy()" class="bg-blue-600 text-white px-5 py-2 mt-4 rounded-lg hover:bg-blue-700 transition">Check Practice</button>
        <div id="feedback" class="mt-4 text-sm font-semibold"></div>
      `;
    }

    // Check accuracy
    function checkAccuracy() {
      const userInput = document.getElementById("inputText").value.trim();
      const expected = activities[currentIndex].expected.trim();

      if (userInput.length === 0) {
        alert("You must complete the practice before checking!");
        return;
      }

      // Compare accuracy
      let correct = 0;
      for (let i = 0; i < Math.min(expected.length, userInput.length); i++) {
        if (expected[i] === userInput[i]) correct++;
      }

      const accuracy = Math.round((correct / expected.length) * 100);
      const feedback = document.getElementById("feedback");

      if (accuracy >= minAccuracy && userInput.length >= expected.length) {
        feedback.innerHTML = `<span class="text-green-600">‚úÖ Excellent! Accuracy: ${accuracy}% ‚Äî Moving to next practice...</span>`;
        setTimeout(() => {
          currentIndex++;
          localStorage.setItem("currentPractice", currentIndex);
          loadActivity();
        }, 1500);
      } else {
        feedback.innerHTML = `<span class="text-red-600">‚ùå Accuracy: ${accuracy}%. Minimum required is ${minAccuracy}%. Please try again carefully.</span>`;
      }
    }
  </script>
</body>
</html>
